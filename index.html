<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomato Timer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'%3e%3ccircle cx='25' cy='30' r='20' fill='%23ff6b6b'/%3e%3cellipse cx='25' cy='15' rx='3' ry='8' fill='%23228B22'/%3e%3c/svg%3e">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>
            P<svg width="40" height="40" viewBox="0 0 50 50" style="margin:0;">
                <circle cx="25" cy="30" r="20" fill="#ff6b6b"/>
                <ellipse cx="25" cy="15" rx="3" ry="8" fill="#228B22"/>
            </svg>mato Timer
        </h1>
    </header>
    <div id="app">
        <div v-if="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading Pomato Timer...</p>
        </div>
        <main v-else>
        <main>
            <div class="tabs">
                <button @click="setMode('Work')" :class="{ active: currentMode === 'Work' }">Work</button>
                <button @click="setMode('Short Break')" :class="{ active: currentMode === 'Short Break' }">Short Break</button>
                <button @click="setMode('Long Break')" :class="{ active: currentMode === 'Long Break' }">Long Break</button>
            </div>
            <div class="timer">
                <div class="time-display">{{ formattedTime }}</div>
                <div class="status">{{ currentMode === 'Work' ? settings.title : currentMode }}</div>
                <div class="controls">
                    <!-- When not running (paused or fresh), show Start -->
                    <button v-if="!isRunning" @click="startTimer">Start</button>

                    <!-- When running, show Pause + Reset -->
                    <template v-else>
                        <button @click="pauseTimer">Pause</button>
                        <button @click="resetTimer">Reset</button>
                    </template>
                </div>
            </div>
            <div class="settings">
                <button @click="openSettings" class="icon-btn" aria-label="Settings">
                    <svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="g-settings" x1="0" x2="1">
                                <stop offset="0" stop-color="#ff6b6b"/>
                                <stop offset="1" stop-color="#ff5252"/>
                            </linearGradient>
                        </defs>
                        <g fill="none" stroke="url(#g-settings)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3.2"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 0 1 2.3 18.1l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82L4.3 6.3A2 2 0 1 1 7.13 3.47l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09c0 .63.39 1.18 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 0 1 21.7 5.9l-.06.06a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09c-.63 0-1.18.39-1.51 1z"/>
                        </g>
                    </svg>
                </button>
                <button @click="showDashboardModal = true" class="icon-btn" aria-label="Dashboard">
                    <svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="g-dash" x1="0" x2="1">
                                <stop offset="0" stop-color="#4da6ff"/>
                                <stop offset="1" stop-color="#66c2ff"/>
                            </linearGradient>
                        </defs>
                        <rect x="3" y="12" width="4" height="9" rx="1" fill="url(#g-dash)" />
                        <rect x="9" y="7" width="4" height="14" rx="1" fill="url(#g-dash)" />
                        <rect x="15" y="3" width="6" height="18" rx="1" fill="url(#g-dash)" />
                    </svg>
                </button>
                <button @click="showLogViewer = true" class="icon-btn" aria-label="Logs">
                    <svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="g-log" x1="0" x2="1">
                                <stop offset="0" stop-color="#9be15d"/>
                                <stop offset="1" stop-color="#00e3ae"/>
                            </linearGradient>
                        </defs>
                        <rect x="4" y="3" width="14" height="18" rx="2" fill="none" stroke="url(#g-log)" stroke-width="1.6" />
                        <path d="M8 7h8M8 11h8M8 15h6" stroke="url(#g-log)" stroke-width="1.6" stroke-linecap="round" fill="none" />
                        <rect x="18" y="7" width="2" height="10" rx="1" fill="url(#g-log)" />
                    </svg>
                </button>
            </div>
        </main>
                <div v-if="showSettings" class="modal">
            <div class="modal-content">
                <h2>Settings</h2>
                <label>Title: <input v-model="settingsDraft.title" type="text"></label>

                <label class="range-row">Work (mins):
                    <input v-model.number="settingsDraft.work" type="range" min="1" max="60" step="1">
                    <span class="track-tint" :style="{ width: (settingsDraft ? (settingsDraft.work / 60 * 100) : 0) + '%' }"></span>
                    <span class="range-value">{{ settingsDraft.work }}m</span>
                </label>

                <label class="range-row">Short Break (mins):
                    <input v-model.number="settingsDraft.shortBreak" type="range" min="1" max="60" step="1">
                    <span class="track-tint" :style="{ width: (settingsDraft ? (settingsDraft.shortBreak / 60 * 100) : 0) + '%' }"></span>
                    <span class="range-value">{{ settingsDraft.shortBreak }}m</span>
                </label>

                <label class="range-row">Long Break (mins):
                    <input v-model.number="settingsDraft.longBreak" type="range" min="1" max="60" step="1">
                    <span class="track-tint" :style="{ width: (settingsDraft ? (settingsDraft.longBreak / 60 * 100) : 0) + '%' }"></span>
                    <span class="range-value">{{ settingsDraft.longBreak }}m</span>
                </label>

                <label>Auto Start: <input v-model="settingsDraft.autoStart" type="checkbox"></label>
                <label>Notifications: <input v-model="settingsDraft.notifications" type="checkbox"></label>
                <label>Sound: <input v-model="settingsDraft.sound" type="checkbox"></label>
                <div class="modal-actions">
                    <button class="btn primary" @click="commitSettings">Save</button>
                    <button class="btn ghost" @click="cancelSettings">Cancel</button>
                </div>
            </div>
        </div>
                <div v-if="showDashboardModal" class="modal">
            <div class="modal-content dashboard-modal">
                <h2>Dashboard</h2>
                <p>Total Sessions: {{ sessionCount }}</p>
                <p>Total Pomodoros: {{ completedPomodoros }}</p>
                <div class="progress-bar">
                    <div class="progress" :style="{width: progressPercent + '%'}"></div>
                    <span class="progress-text">{{ Math.round(progressPercent) }}% Complete</span>
                </div>
                <div v-if="activities.length === 0" class="no-data">No sessions yet. Complete some pomodoros to see your progress!</div>
                <div v-else>
                    <h3>Daily Progress</h3>
                    <canvas id="lineChart"></canvas>
                    <h3>Session History</h3>
                    <canvas id="chart"></canvas>
                    <div style="display:flex;gap:18px;margin-top:12px;flex-wrap:wrap;">
                        <div class="panel" style="flex:1;min-width:160px;padding:12px;">
                            <strong>Total Work Time</strong>
                            <div style="color:var(--muted);margin-top:6px;">{{ formatMinutes(totalWorkMinutes) }}</div>
                        </div>
                        <div class="panel" style="flex:1;min-width:160px;padding:12px;">
                            <strong>Breaks Taken</strong>
                            <div style="color:var(--muted);margin-top:6px;">{{ totalBreaksTaken }} breaks Â· {{ formatMinutes(totalBreakMinutes) }}</div>
                        </div>
                        <div class="panel" style="flex:1;min-width:160px;padding:12px;">
                            <strong>Total Pomodoros</strong>
                            <div style="color:var(--muted);margin-top:6px;">{{ completedPomodoros }}</div>
                        </div>
                    </div>
                </div>
                <button @click="showDashboardModal = false" class="close-btn">Close</button>
            </div>
        </div>
        <div v-if="showLogViewer" class="modal">
            <div class="modal-content log-modal">
                <h2>Activity Logs</h2>
                <div v-if="activities.length === 0" class="no-data">No activities logged yet.</div>
                <div v-else class="log-list">
                    <div v-for="(activity, index) in activities.slice().reverse()" :key="index" class="log-entry">
                        <div class="log-header">
                            <strong>{{ activity.mode }}</strong>
                            <span v-if="activity.title"> - {{ activity.title }}</span>
                            <span class="log-status" :class="{ completed: activity.completed, paused: !activity.completed }">
                                {{ activity.completed ? 'Completed' : 'Paused' }}
                            </span>
                        </div>
                        <div class="log-details">
                            <span>Started: {{ new Date(activity.start).toLocaleString() }}</span>
                            <span v-if="activity.end">Ended: {{ new Date(activity.end).toLocaleString() }}</span>
                            <span>Duration: {{ Math.floor(activity.elapsed / 60) }}m {{ activity.elapsed % 60 }}s</span>
                        </div>
                    </div>
                </div>
                <button @click="showLogViewer = false" class="close-btn">Close</button>
            </div>
        </div>
    </div>
    <script src="lib/vue.global.js"></script>
    <script src="lib/chart.js"></script>
    <script src="js/app.js"></script>
</body>
</html>